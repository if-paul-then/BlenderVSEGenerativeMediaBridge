# Requirements: VSE Generative Media Bridge
This document outlines the requirements for a flexible Blender addon that acts as a bridge between the Video Sequence Editor (VSE) and external, command-line generative tools.

## Addon Preferences
### Generator List
The addon preferences shows a list of defined generators.
Generators can be added or deleted.

### Generator Configuration
A generator's configuration is YAML based. To edit the config of a generator, a multi-line text field should be made available.

The YAML config should have the following schema:

```YAML
name: string # The name of the generator
command: # Configuration for local command to be called
  program: string # The command to be called, possibly including the path e.g. "C:\programs\text-to-speach.exe".
  arguments: string # The arguments to be passed to the program.
                    # Arguments could contain property placeholders specified by the property name between curly braces e.g. {Prompt}.
					# Example argument list: "text={Prompt}" -output "{Result}"
  argument-list: # Alternative, more flexible, method to define arguments to be passed to the program.
                 # arguments and argument-list are mutually exclusive.
    - argument: string # Argument text to be passed e.g. "-text".
	  if-property-set: string # A property name e.g. {Prompt}. If argument will only be sent if the property is set. Optional.
properties: # Describes placeholders in arguments.
  input: # Represents existing VSE strips whose values or media will be passed to the generator's program via arguments.
	- name: string # The name of the input property.
    type: string # Media type of the property. Valid values are: "text", "image", "audio" or "video".
	  pass-via: string # The mechanism by which the media will be passed to the generator.
	                   # Valid values are: "file", "text" or "stream".
	                   # For media types "image", "audio" and "video", valid values are "file" (default) or "stream".
					   # For media type "text", valid values are "text" (the default), "file" or "stream".
	  required: boolean # Whether the property is optional. Default: true.
  output: # Represents VSE strips which will be created or updated from the media generated by the generator program.
	- name: string # The name of the output property.
    type: string # Media type of the property. Valid values are: "text", "image", "audio" or "video".
	  pass-via: string # The mechanism by which the generated media will be received from the generator.
	                   # Valid values are: "file" (default) or "stream".
	  file-ext: string # The file extention of the generated media e.g. ".wav".
	  required: boolean # The program can only be called once all required properties are set. Default: true.
```

### Future enhancements
- Options other than command could include: http, open-api, script, mcp
- A configurable list of programs to not allow which might pose a risk to the user e.g. rmdir.

## Add Menu
The user adds a new strip from the VSE Add menu where there should be a new option called Generative Media. This option should have sub-options for each configured media Generator. When a generator is selected, then a new strip should be added to the VSE timeline.

### Strip Type
The type of the added strip depends on the number of defined output properties and the property media type as follows:
- Only one output parameter, where the media type is:
  - "text", then a Text strip is added.
  - "image", then a Image strip is added.
  - "audio", then a Sound strip is added.
  - "video", then a Movie strip is added.
- More than one parameter, then a controller strip is added.

In the case of a controller strip, like with an Effect Strip, it does not contain media itself.

For the remaining strip types, the strip contains the generated media. In this case, if Blender doesn't allow a strip the strip to be created without media, then placeholder media should be used until the actual media is generated.

### Preselected Strips at Add Generator
If the user has preselected strips before choosing a Generator, then these preselected strips should be used as the input arguments where they match the types of the defined input parameters. For example, if a text strip and two image strips are selected for a generator with text and two image properties then the text strip should be matched to the text parameter, the first of the two image strips to first image parameter and the second to the second image parameter. Any selected strips that cannot be matched as arguments to defined parameters must be ignored.

## Side Panel
The side panel of the added strip must have a section called Generative Media.

### Generator Name
There must be read-only property with the Generator's name and label "Generator:".

### Configured Properties
There should also be a property for each defined property of the generator. The label should be the defined property's name.

The properties should use the Pointer Property approach to reference the input or output strip it is referencing. If the defined property's type is "text", then its panel property could be a user choice between a Pointer Property or a multi-line text field where the user could enter the text value.

On adding of the strip, some of the input properties might already be set if the strips they refer to were selected and matched when the new strip's generator was selected as descripted above.

There should be a visual indication if a property is required based on the defined property's "required" attribute.

### Generate Button
Lastly there should be Generate button which will call the generator to generate the media for the strip. The Generate button must be disabled if all required properties haven't been set.

### Generating Media
While generating media, there should be a visual indication or que to the user that the generator is still busy. The user should also be able to cancel the generation.

### Error Handling
If the external program returns an error, this should be clearly communicated to the user.
